!function(a,b,c){var d=function(){function b(b){a.msg={action:"notification",info:b},chrome.notifications.create("",{type:"basic",title:b.albumtitle,message:b.artist+" - "+b.title,iconUrl:b.picture},function(a){setTimeout(function(){chrome.notifications.clear(a,function(){})},3e3)})}var d,e,f,g,h,i="http://douban.fm",j=[],k=-1,l=[],m=0,n={},o=new Audio,p=!1;o.autoplay=!0;var q={isAd:function(a){try{return!/^\/subject\//.test(a.album)}catch(b){return!1}},initSong:function(a,b){var d=this,b=b===c?!0:!1;return this.isAd(a)?d.initSong.caller.apply(this):(n=a,o.src=a.url,b&&(k=j.length,j.push(a))),this},getRoot:function(){return i},getState:function(){return d},getLength:function(){return e},getSongInfo:function(){return n},getCurTime:function(){return o.currentTime},getPlayingProgress:function(){return g},getLoadingProgress:function(){return f},getSongList:function(){return j},getNextSongList:function(a,b){var c=this,d=!!Util.cookie("show_pro_expire_tip")||!!Util.cookie("show_pro_init_tip"),e={type:a?a:"n",sid:n.sid,pt:Math.round(10*o.currentTime)/10,channel:channel.getCurChannel()||0,pb:64,from:"mainsite",r:Math.round(0xffffffffff*Math.random()).toString(16)};d&&(e.pb=192,e.kbps=192),Util.ajax({url:i+"/j/mine/playlist",data:e,success:function(c){"e"!==a&&(m=0,l=c.song),b&&b(c)},error:function(){setTimeout(function(){c.getNextSongList(a,b)},1e4)}})},play:function(){return o.currentTime=0,o.play(),this},pause:function(){return o.pause(),this},resume:function(){return o.play(),this},prev:function(){return k=--k>=0?k:0,this.initSong(j[k],!1),this},heart:function(a){return this.getNextSongList(a?"r":"u",function(){n.like=!n.like}),this},end:function(){var a=this;return a.getNextSongList("e"),l[++m]!==c?a.initSong(l[m]):this.getNextSongList("p",function(b){a.initSong(b.song[0])}),this},trash:function(){var a=this;return this.getNextSongList("b",function(b){a.initSong(b.song[0])}),this},next:function(){var a=this;return this.getNextSongList("s",function(b){a.initSong(b.song[0])}),this},vol:function(a){return a!==c?(a=parseInt(a),a=a>100?100:0>a?0:a,o.volume=a/100,this):h},volUp:function(a){return this.vol(h+a),this},volDown:function(a){return this.vol(h-a),this},mute:function(){return this.vol(0),this},jumpTo:function(a){var b,c=[],d=0;return"number"==typeof a?d=a:"string"==typeof a&&("%"===a.substr(-1)?d=parseInt(a.slice(0,-1))*o.duration/100:(c=a.split(":"),b=c.length,c.forEach(function(a,c){d+=parseInt(a)*Math.pow(60,b-1-c)}))),"number"==typeof d&&(o.currentTime=parseInt(d)),this},loop:function(a){return a===c?p:(p=o.loop=!!a,this)},bind:function(a,b){o.addEventListener(a,b)},once:function(a,b){o.addEventListener(a,function(c){b(c),this.removeEventListener(a,arguments.callee)})}};return o.addEventListener("loadstart",function(){d=o.paused?"paused":"playing",e=o.duration,g=o.currentTime/o.duration,h=100*o.volume,o.loop=p,b(n)}),o.addEventListener("play",function(){d="playing"}),o.addEventListener("pause",function(){d="pause"}),o.addEventListener("durationchange",function(){e=o.duration}),o.addEventListener("timeupdate",function(){var a=o.buffered.length?o.buffered.length-1:0;try{f=o.buffered.end(a)/e}catch(b){f=0}}),o.addEventListener("timeupdate",function(){g=o.currentTime/e}),o.addEventListener("volumechange",function(){h=100*o.volume}),o.addEventListener("ended",function(){p?q.play():q.end()}),o.addEventListener("error",function(){q.end()}),q};a.Player=d}(window,document);