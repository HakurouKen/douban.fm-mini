!function(a,b){var c=function(a){var c=0,d={id:0,name:"我的私人兆赫",isMine:!0},e={sys:[{name:"我的私人兆赫",id:0},{name:"我的红心兆赫",id:-3}],fav:[],hot:[],trend:[],search:{key:"",result:[]}};return{getCurChannel:function(){return c},getChannels:function(){return e},getCurInfo:function(){return d},isMine:function(a){var b=[].concat(e.sys,e.fav,e.hot,e.trend).map(function(a){return parseInt(a.id)});return a=parseInt(a),b.indexOf(a)>=0},changeChannel:function(f,g){var h,i=function(){a.getNextSongList("n",function(b){a.initSong(b.song[0])})},j=[],k=[];c!==parseInt(f)&&b.ajax({url:a.getRoot()+"/j/change_channel?fcid="+c+"&tcid="+f+"&area="+g,success:function(g){c=parseInt(f),j=j.concat(e.sys,e.fav,e.hot,e.trend),k=j.map(function(a){return parseInt(a.id)}),(h=k.indexOf(c))>=0?(d=j[h],"0"===g.r&&i()):b.ajax({url:a.getRoot()+"/j/explore/get_channel_info?cid="+f,success:function(a){d=a.data.res,i()}})}})},init:function(c){var d={total:3,complete:0},f=function(c,e){b.ajax({url:a.getRoot()+c,success:function(a){e(a),d.complete++},error:function(){d.complete++}})};f("/j/fav_channels",function(a){e.fav=a.channels}),e.hot.length?d.total--:f("/j/explore/hot_channels",function(a){a.status&&(e.hot=a.data.channels)}),e.trend.length?d.total--:f("/j/explore/up_trending_channels",function(a){a.status&&(e.trend=a.data.channels)}),b.observe(d,function(){d.total===d.complete&&c(e)})},isFav:function(a){return a=parseInt(a),!e.fav.every(function(b){return parseInt(b.id)!==a})},fav:function(c,d){var f=this.isFav(c);f?d&&d():(b.ajax({url:a.getRoot()+"/j/explore/fav_channel?cid="+c,success:function(a){a.status&&d&&d(c)}}),b.ajax({url:a.getRoot()+"/j/explore/get_channel_info?cid="+c,success:function(a){a.status&&e.fav.push(a.data.res)}}))},unfav:function(c,d){c=parseInt(c),b.ajax({url:a.getRoot()+"/j/explore/unfav_channel?cid="+c,success:function(){e.fav.every(function(a,b){return parseInt(a.id)===c&&e.fav.splice(b,1),parseInt(a.id)!==c}),d&&d(c)}})},search:function(c,d){b.ajax({url:a.getRoot()+"/j/explore/search",data:{query:c.keyword||"",start:c.start||0,limit:c.limit||100},success:function(a){a.status&&(e.search.key=c.keyword,e.search.result=a.data.channels,d&&d(a.data.channels))}})}}};a.Channel=c}(window,Util);